{"version":3,"sources":["../src/index.ts"],"names":["dotenv","config","app","appEnv","process","env","APP_ENV","graphqlPath","use","bodyParser","json","authMiddleware","port","PORT","then","console","log","schema","resolvers","UserResolver","authChecker","globalMiddlewares","ErrorInterceptor","server","ApolloServer","playground","context","req","user","applyMiddleware","cors","path","listen","catch","error"],"mappings":";;;;AACA;;AACA;;AAIA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAGA;;AACA;;AAhBA;AAIAA,gBAAOC,MAAP;;AAcA;AACA,MAAMC,GAAG,GAAG,uBAAZ;AAEA;;AACA,MAAMC,MAAM,GAAGC,OAAO,CAACC,GAAR,CAAYC,OAAZ,IAAuB,aAAtC;AAEA;;AACA,MAAMC,WAAW,GAAG,UAApB,C,CAEA;;AACAL,GAAG,CAACM,GAAJ,CAAQC,oBAAWC,IAAX,EAAR;AACAR,GAAG,CAACM,GAAJ,CAAQD,WAAR,EAAqBI,qBAArB;AAEA,qBAAOT,GAAP;AAEA;;AACA,MAAMU,IAAI,GAAGR,OAAO,CAACC,GAAR,CAAYQ,IAAZ,IAAoB,IAAjC;AAEA,iCACGC,IADH,CACQ,YAAY;AAChBC,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AAEA,QAAMC,MAAM,GAAG,MAAM,8BAAY;AAC/BC,IAAAA,SAAS,EAAE,CACTC,uBADS,CADoB;AAI/B;AACAC,IAAAA,WAAW,EAAXA,kBAL+B;AAM/BC,IAAAA,iBAAiB,EAAE,CAACC,uBAAD;AANY,GAAZ,CAArB;AASA,QAAMC,MAAM,GAAG,IAAIC,iCAAJ,CAAiB;AAC9BP,IAAAA,MAD8B;AAE9BQ,IAAAA,UAAU,EAAE,IAFkB;AAG9BC,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAa;AACpB,YAAMD,OAAO,GAAG;AACdE,QAAAA,IAAI,EAAED,GAAG,CAAC,MAAD,CADK,CACK;;AADL,OAAhB;AAGA,aAAOD,OAAP;AACD;AAR6B,GAAjB,CAAf;AAUAH,EAAAA,MAAM,CAACM,eAAP,CAAuB;AAAE3B,IAAAA,GAAF;AAAO4B,IAAAA,IAAI,EAAE,KAAb;AAAoBC,IAAAA,IAAI,EAAExB;AAA1B,GAAvB;AACAL,EAAAA,GAAG,CAAC8B,MAAJ,CAAWpB,IAAX,EAAiB,MAAMG,OAAO,CAACC,GAAR,CAAa,4BAA2BJ,IAAK,EAA7C,CAAvB;AACD,CAzBH,EA0BGqB,KA1BH,CA0BUC,KAAD,IAAWnB,OAAO,CAACC,GAAR,CAAYkB,KAAZ,CA1BpB","sourcesContent":["/** Init env vars MUST BE FIRST */\nimport 'reflect-metadata';\nimport dotenv from \"dotenv\";\n\ndotenv.config();\n\nimport { ApolloServer } from 'apollo-server-express';\nimport bodyParser from 'body-parser';\nimport express from 'express';\nimport { buildSchema } from 'type-graphql';\nimport { createConnection } from 'typeorm';\n\nimport {\n  UserResolver,\n} from './resolvers';\nimport router from './routes';\nimport { authMiddleware, ErrorInterceptor, authChecker } from './utils';\n\n/** Create app */\nconst app = express();\n\n/** Init Sentry */\nconst appEnv = process.env.APP_ENV || 'development';\n\n/** Add middleware */\nconst graphqlPath = '/graphql';\n\n// TODO make this secure in production\napp.use(bodyParser.json());\napp.use(graphqlPath, authMiddleware);\n\nrouter(app);\n\n/** Run server after connecting to DB */\nconst port = process.env.PORT || 5000;\n\ncreateConnection()\n  .then(async () => {\n    console.log('DB READY');\n\n    const schema = await buildSchema({\n      resolvers: [\n        UserResolver,\n      ],\n      // this is the type-graphql auth middleware for field-level auth\n      authChecker,\n      globalMiddlewares: [ErrorInterceptor],\n    });\n\n    const server = new ApolloServer({\n      schema,\n      playground: true,\n      context: ({ req }) => {\n        const context = {\n          user: req['user'], // from auth middleware\n        };\n        return context;\n      },\n    });\n    server.applyMiddleware({ app, cors: false, path: graphqlPath });\n    app.listen(port, () => console.log(`Server listening on port ${port}`));\n  })\n  .catch((error) => console.log(error));"],"file":"index.js"}