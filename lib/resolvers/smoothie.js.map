{"version":3,"sources":["../../src/resolvers/smoothie.ts"],"names":["SmoothieResolver","Smoothie","nullable","Boolean","Ingredient","smoothie","name","ctx","findOne","where","user","userId","relations","smoothies","find","deleteRecipe","User","email","Error","delete","addRecipe","smoothieData","errors","length","connection","response","manager","save","ingredientsData","ingredients","smoothieIngredients","x","ingredientData","ingredient","quantity","unit","push"],"mappings":"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","sourcesContent":["import {\n  Resolver,\n  Query,\n  Arg,\n  Mutation,\n  Ctx,\n  Authorized,\n  FieldResolver,\n  Root,\n} from 'type-graphql';\nimport { validate } from \"class-validator\";\n\nimport { Context } from '../types';\n\nimport Smoothie from '../entity/Smoothie';\nimport Ingredient from '../entity/Ingredient';\nimport { SmoothieInput } from '../types/smoothie';\nimport User from '../entity/User';\nimport { getConnection } from 'typeorm';\n\n  \n@Resolver(Smoothie)\nexport class SmoothieResolver {\n  @Authorized()\n  @Query(() => Smoothie, { nullable: true })\n  async smoothie(\n    @Arg(\"name\", { nullable: false }) name: string,\n    @Ctx() ctx: Context\n  ): Promise<Smoothie | undefined> {\n    return Smoothie.findOne({\n      where: {\n        user: ctx.userId,\n        name\n      },\n      relations: ['ingredients']\n    });\n  }\n\n  @Authorized()\n  @Query(() => [Smoothie], { nullable: true })\n  async smoothies(\n    @Ctx() ctx: Context\n  ): Promise<Smoothie[] | undefined> {\n    return Smoothie.find({\n      where: {\n        user: ctx.userId\n      },\n      relations: ['ingredients']\n    });\n  }\n\n  @Authorized()\n  @Mutation(() => Boolean)\n  async deleteRecipe(\n    @Arg(\"name\", { nullable: false }) name: string,\n    @Ctx() ctx: Context\n  ): Promise<boolean> {\n    const user = await User.findOne({email: ctx.email});\n\n    if (!user) throw new Error('User doesnt exist')\n\n    await Smoothie.delete({\n      name,\n      user\n    })\n\n    return true;\n  };\n\n  @Authorized()\n  @Mutation(() => Smoothie)\n  async addRecipe(\n    @Arg(\"data\") smoothieData: SmoothieInput, \n    @Ctx() ctx: Context\n  ): Promise<Smoothie> {\n    const user = await User.findOne({email: ctx.email});\n\n    if (!user) throw new Error('User doesnt exist')\n\n    const smoothie = new Smoothie();\n\n    smoothie.name = smoothieData.name;\n    smoothie.user = user;\n\n    const errors = await validate(user);\n\n    if (errors.length > 0) {\n      throw new Error('Error creating new user'); \n    } else {\n      const connection = getConnection();\n      const response = await connection.manager.save(Smoothie, smoothie)\n      let ingredientsData = smoothieData.ingredients || []\n      let smoothieIngredients:Ingredient[] = []\n\n      for (let x = 0; x < ingredientsData.length; x ++) {\n        const ingredientData = ingredientsData[x];\n  \n        const ingredient = new Ingredient();\n        ingredient.name = ingredientData.name;\n        ingredient.quantity = ingredientData.quantity;\n        ingredient.unit = ingredientData.unit\n        ingredient.smoothie = response;\n  \n        smoothieIngredients.push(await connection.manager.save(Ingredient, ingredient))\n      }\n\n      smoothie.ingredients = smoothieIngredients;\n\n      return smoothie;\n    }\n  }\n\n  @FieldResolver(() => [Ingredient], {nullable: true})\n  async ingredients(@Root() smoothie: Smoothie): Promise<Ingredient[]> {\n    return smoothie.ingredients || []\n  }\n}\n  "],"file":"smoothie.js"}