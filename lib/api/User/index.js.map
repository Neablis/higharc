{"version":3,"sources":["../../../src/api/User/index.ts"],"names":["UserRouter","use","isLoggedIn","route","get","req","resp","email","context","user","User","findOne","relations","status","send","results","delete","createQueryBuilder","from","where","execute"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,MAAMA,UAAU,GAAG,sBAAnB;AAEAA,UAAU,CAACC,GAAX,CAAeC,iBAAf;AAEAF,UAAU,CAACG,KAAX,CAAiB,GAAjB,EACGC,GADH,CACO,OAAOC,GAAP,EAAYC,IAAZ,KAAoC;AACvC,QAAM;AAAEC,IAAAA;AAAF,MAAYF,GAAG,CAACG,OAAtB;AACA,QAAMC,IAAI,GAAG,MAAMC,cAAKC,OAAL,CACjB;AAAEJ,IAAAA;AAAF,GADiB,EAEjB;AAAEK,IAAAA,SAAS,EAAE,CAAC,WAAD,EAAc,uBAAd;AAAb,GAFiB,CAAnB;;AAKA,MAAI,CAACH,IAAL,EAAW;AACTH,IAAAA,IAAI,CAACO,MAAL,CAAY,GAAZ,EAAiBC,IAAjB,CAAsB,qBAAtB;AACD,GAFD,MAEO;AACL,UAAMC,OAAO,GAAG,oCAAaN,IAAb,CAAhB;AAEAH,IAAAA,IAAI,CAACQ,IAAL,CAAUC,OAAV;AACD;AACF,CAfH,EAgBGC,MAhBH,CAgBU,OAAOX,GAAP,EAAYC,IAAZ,KAAoC;AAC1C,QAAM;AAAEC,IAAAA;AAAF,MAAYF,GAAG,CAACG,OAAtB;AAEA,QAAM,8BACHS,kBADG,GAEHD,MAFG,GAGHE,IAHG,CAGER,aAHF,EAIHS,KAJG,CAIG,gBAJH,EAIqB;AAAEZ,IAAAA;AAAF,GAJrB,EAKHa,OALG,EAAN;AAOAd,EAAAA,IAAI,CAACQ,IAAL,CAAU,IAAV;AACD,CA3BH;eA6Bed,U","sourcesContent":["import User from \"../../entity/User\"\nimport { Router } from \"express\"\nimport { isLoggedIn } from \"../../utils\"\nimport { getConnection } from \"typeorm\"\nimport { classToPlain } from \"class-transformer\"\n\nconst UserRouter = Router()\n\nUserRouter.use(isLoggedIn)\n\nUserRouter.route(\"/\")\n  .get(async (req, resp): Promise<void> => {\n    const { email } = req.context\n    const user = await User.findOne(\n      { email }, \n      { relations: [\"smoothies\", \"smoothies.ingredients\"] }\n    )\n\n    if (!user) {\n      resp.status(404).send(\"Could not find user\")\n    } else {\n      const results = classToPlain(user)\n\n      resp.send(results)\n    }\n  })\n  .delete(async (req, resp): Promise<void> => {\n    const { email } = req.context\n\n    await getConnection()\n      .createQueryBuilder()\n      .delete()\n      .from(User)\n      .where(\"email = :email\", { email })\n      .execute()\n\n    resp.send(true)\n  })\n\nexport default UserRouter"],"file":"index.js"}